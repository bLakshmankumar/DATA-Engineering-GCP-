Explanation of IAM & Admin in GCP :
=================================
IAM in GCP is used to control access to cloud resources by defining who can perform what actions on which resources.
It works using identities, roles, and permissions applied through IAM policies.
GCP follows a hierarchical resource model where permissions inherit from organization to project to resources.
For security, we follow least privilege, avoid basic roles, use service accounts for workloads, and manage access via groups.

What is IAM in GCP? :
=====================
IAM (Identity and Access Management) in GCP controls
who can do what on which resource.
  In short:
    Who ‚Üí Identity    :
    What ‚Üí Permission
    Which resource ‚Üí GCP resource (project, VM, bucket, etc.)
IAM works using 4 main components:
  Identity ‚Üí Role ‚Üí Permissions ‚Üí Resource
Let‚Äôs break them down üëá :
---------------------------
 1. Identity (WHO) :
      An identity is someone or something that needs access.
      Types of identities:
        Google user ‚Üí user@gmail.com
        Service account ‚Üí application or VM identity
        Google group ‚Üí team-based access
        Domain ‚Üí entire organization
     üëâ Best practice:
           Give access to groups, not individual users.
 2. Permissions (WHAT actions)
      Permissions define exact actions allowed.
      Examples:
        compute.instances.start
        storage.objects.get
        container.pods.list
     ‚ö†Ô∏è We never assign permissions directly ‚Äî they are grouped into roles.

 3. Roles (Collection of permissions)
      "A role is a set of permissions".
        Types of roles in GCP:
          Role Type	Description
            Basic roles	Owner, Editor, Viewer (broad, not recommended)
            Predefined roles	Service-specific, recommended
            Custom roles	Created by you, least privilege
      Example:
        roles/compute.admin
        roles/storage.objectViewer
        roles/container.developer
   üëâ Interview Tip:
        Always say ‚ÄúWe prefer predefined or custom roles over basic roles.‚Äù
    Note : we can create multiple roles and assign multiple roles to the same user, service account, or group.
 4. Resources (WHERE access applies)
      IAM policies are applied to resources, such as:
        Organization
        Folder
        Project
        Specific resource (VM, bucket, dataset)
      Resource hierarchy:
        Organization
          ‚îî‚îÄ‚îÄ Folder
                ‚îî‚îÄ‚îÄ Project
                      ‚îî‚îÄ‚îÄ Resources (VM, GKE, Storage)

  5. IAM Policy (How access is granted) :
       Role = What actions are allowed
       IAM Policy = Who gets that role, and on which resource
     Important:
       A role does nothing by itself
       It must be attached via an IAM policy 
     Where IAM Policies are applied :
        IAM policies are attached to resources, such as:
          Organization
          Folder
          Project
          Specific resource (bucket, VM, topic)

     ## Can we assign permissions directly to a user?
     ## ANS : No. Permissions are always assigned through roles, and roles are granted via IAM policies.

# How IAM works in the background (GCP internals ‚Äì simplified) :
================================================================
When a user or service tries to access a resource:
  Step-by-step flow:
    Authentication
      Who are you? (Google account / service account)
    Authorization
      GCP checks IAM policies attached to:
      Resource
      Parent project
      Folder
      Organization
      Permission evaluation
    GCP checks:
      Does any policy grant a role that contains the required permission?
        Decision
          ‚úÖ Allowed ‚Üí request proceeds
          ‚ùå Denied ‚Üí 403 error
        Important:
          IAM policies are additive (no deny rules in standard IAM).

# How to configure Role & Policy (Step-by-step) :
=================================================
  1. Assign a predefined role (Most common) :
     Using GCP Console:
       Go to IAM & Admin ‚Üí IAM
       Select project
       Click Grant Access
       Add:
         Member (user / group / service account)
         Role (e.g., roles/container.developer)
       Save
       ‚úî This creates an IAM policy binding
    2. Create a custom role :
       Go to IAM & Admin ‚Üí Roles
       Create Custom Role
       Select permissions
       Save
       Example : Custom Role: vm-start-stop
         Permissions:
         - compute.instances.start
         - compute.instances.stop 
     3. Attach custom role via policy :
          Same as predefined:
            Add member
            Select custom role
            Save
# Role vs Policy(Interview perspective) :
=========================================
A role is a set of permissions that defines what actions are allowed.
An IAM policy is what actually grants access by binding a role to an identity on a resource.
When a request is made, GCP evaluates IAM policies on the resource hierarchy and checks whether the assigned role contains the required permission.
Access is granted only if both the identity and permission match.

# What is a Service Account : 
=============================
A service account is an identity used by applications or workloads to access GCP services securely.
Instead of using user credentials, applications authenticate as a service account, and GCP authorizes access based on IAM roles assigned to that service account.
Service accounts support secure, non-interactive authentication and are commonly used with VMs, GKE, and CI/CD pipelines following the principle of least privilege.
   Users ‚Üí for humans
   Service Accounts ‚Üí for applications / automation

Why Service Accounts exist (Why not user credentials?)
   Problems with user credentials:
     Passwords expire
     Users leave the company
     Not secure for automation
üëâ Service Accounts solve this by providing:
     Stable identity
     Fine-grained permissions
     Secure authentication

How Service Accounts work :
---------------------------
  Application / VM / Pod
        |
   Service Account
        |
      IAM Role
        |
   GCP Resource
The application assumes the identity of the service account,
and GCP checks IAM roles assigned to that service account.

Authenticate using:
-------------------
   Short-lived OAuth tokens
   Workload Identity
   Permissions are granted via IAM roles

> Types of Service Accounts :
-----------------------------
  1. User-managed Service Account :
      Created by you
      Fully controlled permissions
      Used for apps, CI/CD, GKE
  2. Default Service Accounts (Use carefully ‚ö†Ô∏è) :
      Compute Engine default SA
      Best practice:
        Remove permissions Or don‚Äôt use it
  3. Google-managed Service Accounts :
       Used internally by GCP services
       We usually don‚Äôt manage them

How Service Accounts get permissions :
--------------------------------------
   Service accounts don‚Äôt have permissions by default.
   You assign permissions using IAM roles.
   Example :  
     Service Account: app-sa
     Role: roles/storage.objectAdmin
     Resource: my-project
   This is stored as an IAM policy binding.
 
   Real time Example 1: VM accessing Cloud Storage(Configuration using GCP Console) :
   ----------------------------------------------------------------------------------
      Step 1: Create a Service Account
              Go to IAM & Admin ‚Üí Service Accounts
              Click Create Service Account
              Name: vm-gcs-reader-sa
              Skip role assignment for now
              Create
              Service account email: vm-gcs-reader-sa@PROJECT_ID.iam.gserviceaccount.com
      Step 2: Grant GCS access to the Service Account (Bucket-level access (best practice))
              Go to Cloud Storage ‚Üí Buckets
              Select your bucket
              Go to Permissions
              Add member ‚Üí Service Account
              Role ‚Üí roles/storage.objectViewer
      Step 3: Attach Service Account to VM
              Go to Compute Engine ‚Üí VM Instances
              Create or Edit a VM
              Under Identity and API access:
              Service Account ‚Üí vm-gcs-reader-sa
              Access Scopes ‚Üí Allow full access to all Cloud APIs
              Save / Create VM
              üìå IAM controls access, not access scopes, when using IAM properly.
      Step 4: Verify access from VM
              SSH into the VM and run: gsutil ls gs://YOUR_BUCKET_NAME
                ‚úî Works ‚Üí IAM configured correctly
                ‚ùå Fails ‚Üí Missing role or wrong service account



